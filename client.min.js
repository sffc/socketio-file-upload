/* Socket IO File Upload Client-Side Library
 *   Copyright (C) 2013 Shane Carr
 *   Released under the X11 License
 * For more information, visit: https://github.com/vote539/socketio-file-upload
 */

window.SocketIOFileUpload=function(l){var h=this;if(!window.File||!window.FileReader)throw Error("Socket.IO File Upload: Browser Not Supported");var f={},p=[],t=[];h.fileInputElementId="siofu_input";h.useText=!1;h.serializedOctets=!1;var s=function(a,b){var c=document.createEvent("Event");c.initEvent(a,!1,!1);for(var d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);return h.dispatchEvent(c)},m=[],g=function(a,b,c,d){a.addEventListener(b,c,d);m.push(arguments)},u=function(a,b,c,d){a.removeEventListener&&a.removeEventListener(b,
c,d)},v=function(){for(var a=m.length-1;0<=a;a--)u.apply(this,m[a]);m=[]},w=function(a){if(s("start",{file:a})){var b=new FileReader,c=0,d=p.length,f=h.useText,m;p.push(a);g(b,"progress",function(a){});g(b,"load",function(r){a:{r=r.loaded;var g;if(f)g=b.result.slice(c,r);else try{var n=new Uint8Array(b.result,c,r),p;if(h.serializedOctets)p=n;else{var k,q=n.buffer.byteLength,e="";for(k=0;k<q;k+=3)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[n[k]>>2],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(n[k]&
3)<<4|n[k+1]>>4],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(n[k+1]&15)<<2|n[k+2]>>6],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[n[k+2]&63];2===q%3?e=e.substring(0,e.length-1)+"=":1===q%3&&(e=e.substring(0,e.length-2)+"==");p=e}g=p}catch(t){l.emit("siofu_done",{id:d,interrupt:!0});break a}l.emit("siofu_progress",{id:d,start:c,end:r,content:g,base64:!h.serializedOctets});c=r}l.emit("siofu_done",{id:d});s("load",{file:a,reader:b,name:m})});g(b,"error",
function(){l.emit("siofu_done",{id:d,interrupt:!0})});g(b,"abort",function(){l.emit("siofu_done",{id:d,interrupt:!0})});l.emit("siofu_start",{name:a.name,mtime:a.lastModifiedDate,encoding:f?"text":"octet",id:d});t.push(f?function(c){b.readAsText(a);m=c}:function(c){b.readAsArrayBuffer(a);m=c})}},q=function(a){var b=a.target.files||a.dataTransfer.files;a.preventDefault();if(0<b.length&&s("choose",{files:b}))for(a=0;a<b.length;a++)w(b[a])};this.listenOnInput=function(a){a.files&&g(a,"change",q,!1)};
this.listenOnDrop=function(a){g(a,"dragover",function(a){a.preventDefault()},!1);g(a,"drop",q)};this.prompt=function(){var a;a=document.getElementById(h.fileInputElementId);a||(a=document.createElement("input"),a.setAttribute("type","file"),a.setAttribute("id",h.fileInputElementId),a.style.display="none",document.body.appendChild(a));g(a,"change",q,!1);var b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null);a.dispatchEvent(b)};this.destroy=function(){v();
var a=document.getElementById(h.fileInputElementId);a&&a.parentNode.removeChild(a)};this.addEventListener=function(a,b){f[a]||(f[a]=[]);f[a].push(b)};this.removeEventListener=function(a,b){if(!f[a])return!1;for(var c=0;c<f[a].length;c++)if(f[a][c]===b)return f[a].splice(c,1),!0;return!1};this.dispatchEvent=function(a){var b=f[a.type];if(!b)return!0;for(var c=!0,d=0;d<b.length;d++)!1===b[d](a)&&(c=!1);return c};l.on("siofu_ready",function(a){t[a.id](a.name)});l.on("siofu_complete",function(a){s("complete",
{file:p[a.id],detail:a.detail,success:a.success})})};